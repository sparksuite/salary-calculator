language: node_js
branches:
  only:
    - master
stages:
  - test
  - deploy
jobs:
  include:
    - stage: test
      name: Lint code
      node_js: lts/*
      script:
        - yarn lint
    - stage: test
      name: Verify build
      node_js: lts/*
      script:
        - yarn build
    - stage: test
      name: Run tests
      node_js: lts/*
      script:
        - yarn global add codecov
        - yarn test --coverage
        - codecov
    - stage: deploy
      if: type = push
      name: Deploy to Cloudflare Workers Sites
      node_js: lts/*
      script:
        - yarn build
      deploy:
        provider: script
        script: npx @cloudflare/wrangler publish
        skip_cleanup: true
